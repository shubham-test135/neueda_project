<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wishlist - FinBuddy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/components.css" />
    <link rel="stylesheet" href="../css/wishlist-enhanced.css" />
  </head>
  <body>
    <!-- Sidebar Navigation -->
    <div id="sidebar-container"></div>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Top Navigation Bar -->
      <div id="navbar-container"></div>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Loading Overlay -->
        <div id="wishlistLoading" class="loading-overlay" style="display: none">
          <div class="spinner"></div>
          <p>Loading wishlist...</p>
        </div>

        <div class="content-wrapper">
          <!-- Page Header -->
          <div class="page-header">
            <div>
              <h1 class="page-title">
                <i class="fas fa-star"></i>
                Investment Wishlist
              </h1>
              <p class="page-subtitle">
                Track and monitor assets before adding to your portfolio
                <span class="auto-refresh-badge" title="Prices refresh automatically every 60 seconds">
                  <span class="dot"></span>
                  Auto-refreshing
                </span>
              </p>
            </div>
            <div class="header-actions">
              <button class="btn btn-secondary" id="refreshPricesBtn" title="Click to refresh prices manually">
                <i class="fas fa-sync-alt"></i>
                <span>Refresh</span>
              </button>
              <button class="btn btn-primary" id="addToWishlistBtn">
                <i class="fas fa-plus"></i>
                <span>Add Asset</span>
              </button>
            </div>
          </div>

          <!-- Summary Cards -->
          <div class="summary-cards">
            <div class="card card-animated" title="Total number of assets you're tracking in your wishlist">
              <div class="card-header">
                <div class="card-icon gradient-blue">
                  <i class="fas fa-list"></i>
                </div>
              </div>
              <div class="card-body">
                <h3 class="card-title">Total Watching</h3>
                <p class="card-value" id="totalWatchlist">0</p>
                <small class="card-subtitle">Assets in watchlist</small>
              </div>
            </div>

            <div class="card card-animated" title="Assets with positive price change today">
              <div class="card-header">
                <div class="card-icon gradient-green">
                  <i class="fas fa-arrow-trend-up"></i>
                </div>
              </div>
              <div class="card-body">
                <h3 class="card-title">Gainers</h3>
                <p class="card-value positive" id="gainersCount">0</p>
                <small class="card-subtitle">Up today</small>
              </div>
            </div>

            <div class="card card-animated" title="Assets with negative price change today">
              <div class="card-header">
                <div class="card-icon gradient-red">
                  <i class="fas fa-arrow-trend-down"></i>
                </div>
              </div>
              <div class="card-body">
                <h3 class="card-title">Losers</h3>
                <p class="card-value negative" id="losersCount">0</p>
                <small class="card-subtitle">Down today</small>
              </div>
            </div>

            <div class="card card-animated" title="Set a target price to get notified when asset reaches that price">
              <div class="card-header">
                <div class="card-icon gradient-orange">
                  <i class="fas fa-bell"></i>
                </div>
              </div>
              <div class="card-body">
                <h3 class="card-title">Price Alerts</h3>
                <p class="card-value" id="alertsCount">0</p>
                <small class="card-subtitle">Active alerts</small>
              </div>
            </div>
          </div>

          <!-- Add Asset Form -->
          <div class="section-card add-asset-form" id="addWishlistForm" style="display: none">
            <div class="section-header">
              <div class="section-title">
                <i class="fas fa-plus-circle"></i>
                <h2>Add to Wishlist</h2>
              </div>
              <button class="btn-icon" id="cancelWishlistBtn" aria-label="Close form">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <form id="wishlistForm" class="wishlist-add-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="wishlistAssetType">
                    <i class="fas fa-layer-group"></i> Asset Type
                  </label>
                  <select id="wishlistAssetType" class="form-select" required>
                    <option value="">Select Type</option>
                    <option value="STOCK">Stock</option>
                    <option value="BOND">Bond</option>
                    <option value="MUTUAL_FUND">Mutual Fund</option>
                    <option value="SIP">SIP</option>
                  </select>
                </div>
                <div class="form-group search-group">
                  <label for="wishlistAssetName">
                    <i class="fas fa-search"></i> Search Asset
                    <small>(fuzzy search)</small>
                  </label>
                  <div class="search-wrapper">
                    <input
                      type="text"
                      id="wishlistAssetName"
                      class="form-input"
                      placeholder="Type to search..."
                      autocomplete="off"
                      required
                    />
                    <div class="asset-search-results" id="wishlistSearchResults" style="display: none"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="wishlistAssetSymbol">
                    <i class="fas fa-tag"></i> Symbol
                  </label>
                  <input
                    type="text"
                    id="wishlistAssetSymbol"
                    class="form-input"
                    placeholder="Auto-filled"
                    readonly
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="wishlistTargetPrice">
                    <i class="fas fa-bullseye"></i> Target Price
                  </label>
                  <input
                    type="number"
                    step="0.01"
                    id="wishlistTargetPrice"
                    class="form-input"
                    placeholder="Optional"
                  />
                </div>
              </div>
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelWishlistBtn2">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-star"></i> Add to Wishlist
                </button>
              </div>
            </form>
          </div>

          <!-- Search & Filter Bar -->
          <div class="section-card filter-bar">
            <div class="filter-row">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="search"
                  id="wishlistSearch"
                  placeholder="Search your wishlist..."
                  aria-label="Search wishlist"
                />
              </div>
              <div class="filter-group">
                <select id="categoryFilter" class="form-select" aria-label="Filter by category">
                  <option value="all">All Types</option>
                  <option value="stock">Stocks</option>
                  <option value="bond">Bonds</option>
                  <option value="mutual_fund">Mutual Funds</option>
                  <option value="sip">SIPs</option>
                </select>
                <select id="sortBy" class="form-select" aria-label="Sort by">
                  <option value="added">Recently Added</option>
                  <option value="name">Name (A-Z)</option>
                  <option value="price">Price</option>
                  <option value="change">Change %</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Wishlist Table -->
          <div class="section-card">
            <div class="section-header">
              <div class="section-title">
                <i class="fas fa-bookmark"></i>
                <h2>My Watchlist</h2>
              </div>
            </div>
            <div class="table-responsive">
              <table class="data-table" id="wishlistTable">
                <thead>
                  <tr>
                    <th>Asset</th>
                    <th>Type</th>
                    <th>Current Price</th>
                    <th>Change</th>
                    <th>Added Price</th>
                    <th>Performance</th>
                    <th>Target Price</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="wishlistTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyWishlist" style="display: none">
              <div class="empty-icon">
                <i class="fas fa-star"></i>
              </div>
              <h3>Your wishlist is empty</h3>
              <p>Start tracking assets you're interested in</p>
              <button class="btn btn-primary" id="addFirstItem">
                <i class="fas fa-plus"></i> Add Your First Asset
              </button>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <footer id="footer-container"></footer>
      </main>
    </div>

    <!-- Asset Details Modal -->
    <div class="modal-overlay" id="assetDetailsModal" style="display: none">
      <div class="modal-container modal-large">
        <div class="modal-header">
          <div class="modal-title-group">
            <h2 id="modalAssetSymbol">AAPL</h2>
            <span id="modalAssetName">Apple Inc.</span>
          </div>
          <button class="btn-icon modal-close" id="closeDetailsModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <!-- Price Overview -->
          <div class="modal-stats">
            <div class="stat-item">
              <span class="stat-label">Current Price</span>
              <span class="stat-value" id="modalCurrentPrice">$0.00</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Change</span>
              <span class="stat-value" id="modalChange">0%</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Added Price</span>
              <span class="stat-value" id="modalAddedPrice">$0.00</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Since Added</span>
              <span class="stat-value" id="modalPerformance">0%</span>
            </div>
          </div>

          <!-- Time Period Selector -->
          <div class="chart-controls">
            <div class="time-period-selector">
              <button class="period-btn" data-period="1W">1W</button>
              <button class="period-btn" data-period="1M">1M</button>
              <button class="period-btn active" data-period="3M">3M</button>
              <button class="period-btn" data-period="6M">6M</button>
              <button class="period-btn" data-period="1Y">1Y</button>
              <button class="period-btn" data-period="ALL">ALL</button>
            </div>
          </div>

          <!-- Chart Stats -->
          <div class="chart-stats" id="chartStatsContainer">
            <!-- Populated dynamically -->
          </div>

          <!-- Performance Chart -->
          <div class="chart-container">
            <div class="chart-loading-overlay">
              <div class="chart-spinner"></div>
              <span>Loading chart data...</span>
            </div>
            <canvas id="assetPerformanceChart"></canvas>
          </div>

          <!-- Additional Info -->
          <div class="asset-details-grid">
            <div class="detail-card">
              <i class="fas fa-calendar"></i>
              <div>
                <span class="detail-label">Added On</span>
                <span class="detail-value" id="modalAddedDate">-</span>
              </div>
            </div>
            <div class="detail-card">
              <i class="fas fa-bullseye"></i>
              <div>
                <span class="detail-label">Target Price</span>
                <span class="detail-value" id="modalTargetPrice">Not set</span>
              </div>
            </div>
            <div class="detail-card">
              <i class="fas fa-coins"></i>
              <div>
                <span class="detail-label">Currency</span>
                <span class="detail-value" id="modalCurrency">USD</span>
              </div>
            </div>
            <div class="detail-card">
              <i class="fas fa-layer-group"></i>
              <div>
                <span class="detail-label">Category</span>
                <span class="detail-value" id="modalCategory">Stock</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="modalRemoveBtn">
            <i class="fas fa-trash"></i> Remove
          </button>
          <button class="btn btn-primary" id="modalAddToPortfolioBtn">
            <i class="fas fa-plus"></i> Add to Portfolio
          </button>
        </div>
      </div>
    </div>

    <!-- Add to Portfolio Modal -->
    <div class="modal-overlay" id="addToPortfolioModal" style="display: none">
      <div class="modal-container">
        <div class="modal-header">
          <h2><i class="fas fa-folder-plus"></i> Add to Portfolio</h2>
          <button class="btn-icon modal-close" id="closePortfolioModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="addToPortfolioForm">
            <div class="form-group">
              <label>Asset</label>
              <input type="text" id="portfolioAssetName" class="form-input" readonly />
              <input type="hidden" id="portfolioAssetSymbol" />
              <input type="hidden" id="portfolioAssetType" />
              <input type="hidden" id="portfolioWishlistItemId" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="portfolioQuantity">
                  <i class="fas fa-hashtag"></i> Quantity
                </label>
                <input
                  type="number"
                  id="portfolioQuantity"
                  class="form-input"
                  min="0.001"
                  step="0.001"
                  placeholder="Enter quantity"
                  required
                />
              </div>
              <div class="form-group">
                <label for="portfolioPurchasePrice">
                  <i class="fas fa-dollar-sign"></i> Purchase Price
                </label>
                <input
                  type="number"
                  id="portfolioPurchasePrice"
                  class="form-input"
                  min="0.01"
                  step="0.01"
                  placeholder="Price per unit"
                  required
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="portfolioCurrentPrice">
                  <i class="fas fa-chart-line"></i> Current Price
                </label>
                <input
                  type="number"
                  id="portfolioCurrentPrice"
                  class="form-input"
                  min="0.01"
                  step="0.01"
                  placeholder="Current price"
                  required
                />
              </div>
              <div class="form-group">
                <label for="portfolioPurchaseDate">
                  <i class="fas fa-calendar"></i> Purchase Date
                </label>
                <input
                  type="date"
                  id="portfolioPurchaseDate"
                  class="form-input"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="removeFromWishlist" checked />
                <span>Remove from wishlist after adding</span>
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelPortfolioAdd">
            Cancel
          </button>
          <button type="submit" form="addToPortfolioForm" class="btn btn-primary">
            <i class="fas fa-check"></i> Add to Portfolio
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Scripts -->
    <script type="module" src="../js/main.js"></script>
    <script type="module" src="../js/pages/wishlist-page.js"></script>
  </body>
</html>
